---
title: "Integração com PDV (Point of Sale)"
description: "Guia completo para integração de sistemas de PDV com a BonifiQ"
---

## Introdução

A integração com PDV permite que sistemas de ponto de venda utilizem os recursos de fidelidade da BonifiQ diretamente no fluxo de compra do consumidor. Esta documentação cobre todos os endpoints e fluxos necessários para uma integração completa.

<Info>
  **Base URL da API**: `https://api.bonifiq.com.br/v1/pvt/POS`

  Consulte também a [documentação interativa Swagger](https://api.bonifiq.com.br/apidocs/private/index.html?url=/swagger/Private%20APIs/swagger.json#/POS)
</Info>

## Autenticação

Saiba mais como utilizar a autenticação (Basic Authentication) com a BonifiQ acessando [esse link](https://developers.bonifiq.com.br/api-private/introduction#autentica%C3%A7%C3%A3o)

Todas as requisições para a API de PDV devem incluir as credenciais de autenticação no header usando **Basic Authentication**.

### Obtendo suas Credenciais

Para obter suas credenciais de API, acesse o painel administrativo da BonifiQ:

<Steps>
  <Step title="Acesse o Menu API">
    No painel administrativo, navegue até o menu **API** na barra lateral.
  </Step>
  <Step title="Criar Nova Credencial">
    Clique no botão **\+ CREDENCIAL** para criar uma nova credencial de API.
  </Step>
  <Step title="Selecione o Tipo Privada">
    Escolha a opção **Privada** para gerar credenciais de acesso à API privada (POS).
  </Step>
  <Step title="Copie as Credenciais">
    Após a criação, você receberá um **usuário** e **senha** de API. Guarde essas informações em local seguro.
  </Step>
</Steps>

### Enviando a Autenticação

A autenticação deve ser enviada no header `Authorization` usando o esquema **Basic Auth**. O valor deve ser a codificação Base64 das credenciais no formato `usuario:senha`.

```bash
Authorization: Basic {base64(usuario:senha)}
```

#### Exemplo de Implementação

<CodeGroup>

```bash cURL
# Credenciais de exemplo:
# Usuário: meu_usuario_api
# Senha: minha_senha_secreta

# Codificação Base64 de "meu_usuario_api:minha_senha_secreta"
# Resultado: bWV1X3VzdWFyaW9fYXBpOm1pbmhhX3NlbmhhX3NlY3JldGE=

curl -X POST "https://api.bonifiq.com.br/v1/pvt/POS/rewards/available" \
  -H "Authorization: Basic bWV1X3VzdWFyaW9fYXBpOm1pbmhhX3NlbmhhX3NlY3JldGE=" \
  -H "Content-Type: application/json" \
  -d '{"customerId": "12345678900", "purchaseValue": 150.00}'
```


```javascript JavaScript
const usuario = 'meu_usuario_api';
const senha = 'minha_senha_secreta';

// Codifica as credenciais em Base64
const credenciais = btoa(`${usuario}:${senha}`);

const response = await fetch('https://api.bonifiq.com.br/v1/pvt/POS/rewards/available', {
  method: 'POST',
  headers: {
    'Authorization': `Basic ${credenciais}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    customerId: '12345678900',
    purchaseValue: 150.00
  })
});
```


```csharp C#
var usuario = "meu_usuario_api";
var senha = "minha_senha_secreta";

// Codifica as credenciais em Base64
var credenciais = Convert.ToBase64String(Encoding.UTF8.GetBytes($"{usuario}:{senha}"));

var client = new HttpClient();
client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Basic", credenciais);

var content = new StringContent(
    JsonSerializer.Serialize(new { customerId = "12345678900", purchaseValue = 150.00 }),
    Encoding.UTF8,
    "application/json"
);

var response = await client.PostAsync("https://api.bonifiq.com.br/v1/pvt/POS/rewards/available", content);
```


```python Python
import base64
import requests

usuario = 'meu_usuario_api'
senha = 'minha_senha_secreta'

# Codifica as credenciais em Base64
credenciais = base64.b64encode(f'{usuario}:{senha}'.encode()).decode()

response = requests.post(
    'https://api.bonifiq.com.br/v1/pvt/POS/rewards/available',
    headers={
        'Authorization': f'Basic {credenciais}',
        'Content-Type': 'application/json'
    },
    json={
        'customerId': '12345678900',
        'purchaseValue': 150.00
    }
)
```

</CodeGroup>

<Warning>
  **Segurança das Credenciais**

  - Nunca exponha suas credenciais em código client-side (frontend, aplicativos mobile, etc.)
  - Armazene as credenciais em variáveis de ambiente ou cofres de segredos
  - Não versione arquivos contendo credenciais em repositórios de código
  - Rotacione as credenciais periodicamente
</Warning>

---

## Fluxo Completo de Resgate de Recompensas

O diagrama abaixo ilustra o fluxo completo de resgate de uma recompensa no PDV:

```mermaid
sequenceDiagram
    participant C as Cliente
    participant V as Vendedor
    participant PDV as Sistema PDV
    participant B as BonifiQ

    C->>V: Informa documento (CPF/CNPJ)
    V->>PDV: Insere documento
    PDV->>B: POST /rewards/available
    B-->>PDV: Lista de recompensas
    PDV-->>V: Exibe recompensas disponíveis
    V->>C: Mostra opções de recompensa
    C->>V: Escolhe uma recompensa
    
    alt Validação Habilitada
        PDV->>B: POST /customers/{id}/challenge
        B-->>C: Envia SMS/Email com código PIN
        C->>V: Informa código PIN
        V->>PDV: Insere código PIN
        PDV->>B: POST /customers/{id}/challengevalidate
        B-->>PDV: Código válido
    end
    
    PDV->>B: POST /rewards/{id}/redeem
    B-->>PDV: Recompensa resgatada com sucesso
    PDV->>PDV: Aplica desconto no pedido
    PDV->>V: Exibe desconto aplicado
    V->>C: Informa desconto concedido
```

O fluxo pode ser dividido em três etapas principais:

<CardGroup cols={3}>
  <Card title="1. Consulta de Recompensas" icon="search" color="#3B82F6">
    Consulta das recompensas disponíveis para o cliente
  </Card>
  <Card title="2. Validação (Opcional)" icon="shield-check" color="#EF4444">
    Verificação de identidade via código PIN
  </Card>
  <Card title="3. Resgate e Conclusão" icon="check-circle" color="#10B981">
    Resgate da recompensa e aplicação do desconto
  </Card>
</CardGroup>

---

## Endpoints da API

### 1. Consultar Recompensas Disponíveis

<ParamField path="/rewards/available">
  Retorna a lista de recompensas disponíveis para um cliente específico.
</ParamField>

Este endpoint retorna todas as recompensas configuradas, mesmo aquelas que o cliente não pode usar no momento (por falta de pontos, por exemplo). Isso permite exibir ao cliente quais recompensas ele poderá obter no futuro.

<Accordion title="Request Body">
  <ParamField body="CustomerId" type="string" required>
    Identificador do cliente. Pode ser e-mail ou documento (CPF/CNPJ). **Importante**: Se for documento, utilize apenas números.
  </ParamField>
  <ParamField body="PurchaseValue" type="decimal" required>
    Valor atual do pedido. **Não deve incluir** descontos, cupons ou outras promoções.
  </ParamField>
  <ParamField body="DiscountValue" type="decimal">
    Valor de desconto já aplicado no pedido (que não seja da BonifiQ). A BonifiQ usa esta informação para retornar apenas recompensas que podem ser acumuladas com outros descontos. Se não houver desconto, envie `null` ou `0`.
  </ParamField>
  <CodeGroup>

  ```json Request
  {
    "customerId": "12345678900",
    "purchaseValue": 150.00,
    "discountValue": null
  }
  ```

  
  ```json Response - Com Recompensas
  {
    "hasRewards": true,
    "shouldValidateCustomer": true,
    "availablePoints": 1500,
    "cashbackEnabled": true,
    "availableCashback": 25.00,
    "maxCashbackForCurrentPurchase": 15.00,
    "rewards": [
      {
        "id": 1,
        "title": "R$10,00 de desconto",
        "rewardType": 1,
        "value": 10.00,
        "canSelectValue": false,
        "isCashback": false,
        "requirements": "Válido para compras acima de R$50,00",
        "availableCashback": 0,
        "maxCashbackForCurrentPurchase": 0,
        "canUse": true,
        "points": 100,
        "rewardCanBeCumulative": true
      },
      {
        "id": 2,
        "title": "15% de desconto",
        "rewardType": 0,
        "value": 15.00,
        "canSelectValue": false,
        "isCashback": false,
        "requirements": "Válido para compras acima de R$100,00",
        "availableCashback": 0,
        "maxCashbackForCurrentPurchase": 0,
        "canUse": true,
        "points": 500,
        "rewardCanBeCumulative": false
      },
      {
        "id": 3,
        "title": "Usar Cashback",
        "rewardType": 3,
        "value": 1.00,
        "canSelectValue": true,
        "isCashback": true,
        "requirements": "Máximo de 10% do valor da compra",
        "availableCashback": 25.00,
        "maxCashbackForCurrentPurchase": 15.00,
        "canUse": true,
        "points": 1500,
        "rewardCanBeCumulative": true
      }
    ]
  }
  ```

  
  ```json Response - Sem Recompensas
  {
    "hasRewards": false,
    "shouldValidateCustomer": false,
    "availablePoints": 50,
    "cashbackEnabled": false,
    "availableCashback": 0,
    "maxCashbackForCurrentPurchase": 0,
    "rewards": []
  }
  ```

  </CodeGroup>
</Accordion>

<Accordion title="Campos de Resposta">
  #### Campos de Resposta Importantes

  <ResponseField name="hasRewards" type="boolean">
    Se `false`, não há recompensas disponíveis. O fluxo de recompensas deve ser ignorado.
  </ResponseField>
  <ResponseField name="shouldValidateCustomer" type="boolean">
    Se `true`, o fluxo deve seguir para a validação do cliente (envio de código PIN). Se `false`, a validação pode ser pulada.
  </ResponseField>
  <ResponseField name="availablePoints" type="integer">
    Quantidade de pontos que o cliente possui atualmente.
  </ResponseField>
  <ResponseField name="cashbackEnabled" type="boolean">
    Se `true`, existe uma recompensa de Cashback configurada.
  </ResponseField>
  <ResponseField name="availableCashback" type="decimal">
    Valor total de cashback que o cliente possui.
  </ResponseField>
  <ResponseField name="maxCashbackForCurrentPurchase" type="decimal">
    Valor máximo de cashback que pode ser utilizado na compra atual, considerando as regras configuradas.
  </ResponseField>
  #### Campos de Cada Recompensa

  <ResponseField name="rewards[].id" type="integer">
    ID único da recompensa. Usado posteriormente no resgate.
  </ResponseField>
  <ResponseField name="rewards[].title" type="string">
    Título amigável da recompensa para exibição ao usuário. Exemplos: "R\$50,00 de desconto", "10% de desconto", "Usar Cashback"
  </ResponseField>
  <ResponseField name="rewards[].rewardType" type="enum">
    Tipo da recompensa:

    - `0` - Desconto Percentual (ex: 15% off)
    - `1` - Desconto em Valor (ex: R\$10,00)
    - `3` - Cashback (ex: R$10,00 em compras acima de R$30,00)
    - `4` - Recompensa Customizada (ex: Brinde)
  </ResponseField>
  <ResponseField name="rewards[].value" type="decimal">
    Valor da recompensa:

    - **Desconto Percentual**: Valor do percentual (ex: `10.00` para 10%)
    - **Desconto em Valor**: Valor em reais (ex: `10.00` para R\$10,00)
    - **Cashback**: Valor de cada ponto em reais
  </ResponseField>
  <ResponseField name="rewards[].canUse" type="boolean">
    Se `true`, o cliente pode usar esta recompensa. Se `false`, exiba a recompensa como desabilitada para que o cliente saiba o que pode conquistar no futuro.
  </ResponseField>
  <ResponseField name="rewards[].points" type="integer">
    Quantidade de pontos necessários para resgatar esta recompensa.
  </ResponseField>
  <ResponseField name="rewards[].requirements" type="string">
    Texto amigável descrevendo os requisitos para usar a recompensa. Exemplo: "Válido para compras acima de R\$50,00"
  </ResponseField>
  <ResponseField name="rewards[].isCashback" type="boolean">
    Se `true`, esta é uma recompensa de cashback e o cliente pode escolher o valor a utilizar.
  </ResponseField>
  <ResponseField name="rewards[].maxCashbackForCurrentPurchase" type="decimal">
    Para cashback, o valor máximo que pode ser usado nesta compra específica.
  </ResponseField>
  <ResponseField name="rewards[].rewardCanBeCumulative" type="boolean">
    Se `true`, a recompensa pode ser usada junto com outros descontos. Se `false`, a recompensa só pode ser usada se não houver outros descontos no pedido.
  </ResponseField>
</Accordion>

---

### 2. Validação do Cliente (Challenge)

A validação é uma etapa de segurança **opcional** que envia um código PIN ao cliente por SMS ou e-mail.

<Steps>
  <Step title="Enviar Challenge">
    Chame o endpoint de challenge para enviar o código PIN ao cliente.
  </Step>
  <Step title="Cliente Recebe o Código">
    O cliente recebe o código por SMS ou e-mail.
  </Step>
  <Step title="Validar Código">
    O cliente informa o código ao vendedor, que valida através da API.
  </Step>
</Steps>

#### 2.1. Enviar Challenge

<ParamField path="/customers/{id}/challenge">
  Envia um código PIN de validação para o cliente.
</ParamField>

##### Path Parameters

<ParamField path="id" type="string" required>
  Identificador do cliente (CPF/CNPJ apenas números, ou e-mail).
</ParamField>

<Accordion title="Request Body e Resposta">
  <ParamField body="TransactionId" type="string">
    ID único para identificar esta transação. Pode ser qualquer string vinculada à compra atual. Se não houver um ID disponível, use o timestamp atual.
  </ParamField>
  <ParamField body="Phone" type="string">
    Telefone do cliente. Use este campo se o cliente ainda não tiver telefone cadastrado na BonifiQ.
  </ParamField>
  <ParamField body="Email" type="string">
    E-mail do cliente. Use este campo se o cliente ainda não tiver e-mail cadastrado na BonifiQ.
  </ParamField>
  <CodeGroup>

  ```json Request
  {
    "transactionId": "PDV-001-2024-01-15-10:30",
    "phone": "11999998888",
    "email": null
  }
  ```

  
  ```json Response - Sucesso
  {
    "success": true,
    "friendlyErrorMessage": null,
    "shouldInformPhone": false,
    "shouldInformEmail": false,
    "sentBySMS": true,
    "sentByEmail": false,
    "transactionId": "PDV-001-2024-01-15-10:30",
    "errorMessage": null,
    "code": null
  }
  ```

  
  ```json Response - Telefone Necessário
  {
    "success": false,
    "friendlyErrorMessage": "É necessário informar o telefone do cliente",
    "shouldInformPhone": true,
    "shouldInformEmail": false,
    "sentBySMS": false,
    "sentByEmail": false,
    "transactionId": "PDV-001-2024-01-15-10:30",
    "errorMessage": "Customer phone not found",
    "code": null
  }
  ```

  </CodeGroup>

  #### Campos de Resposta

  <ResponseField name="success" type="boolean">
    Se `true`, o challenge foi enviado com sucesso.
  </ResponseField>
  <ResponseField name="sentBySMS" type="boolean">
    Se `true`, o código foi enviado por SMS.
  </ResponseField>
  <ResponseField name="sentByEmail" type="boolean">
    Se `true`, o código foi enviado por e-mail.
  </ResponseField>
  <ResponseField name="shouldInformPhone" type="boolean">
    Se `true` e `success=false`, é necessário informar o telefone do cliente em uma nova requisição.
  </ResponseField>
  <ResponseField name="shouldInformEmail" type="boolean">
    Se `true` e `success=false`, é necessário informar o e-mail do cliente em uma nova requisição.
  </ResponseField>
  <ResponseField name="friendlyErrorMessage" type="string">
    Mensagem de erro amigável para exibição ao usuário.
  </ResponseField>
</Accordion>

---

#### 2.2. Validar Challenge

<ParamField path="/customers/{id}/challengevalidate">
  Valida o código PIN informado pelo cliente.
</ParamField>

##### Path Parameters

<ParamField path="id" type="string" required>
  Identificador do cliente (mesmo usado no challenge).
</ParamField>

<Accordion title="Request Body e Resposta">
  <ParamField body="TransactionId" type="string">
    Mesmo ID usado na chamada de challenge.
  </ParamField>
  <ParamField body="Code" type="string" required>
    Código PIN informado pelo cliente.
  </ParamField>
  <CodeGroup>

  ```json Request
  {
    "transactionId": "PDV-001-2024-01-15-10:30",
    "code": "123456"
  }
  ```

  
  ```json Response - Sucesso
  {
    "transactionId": "PDV-001-2024-01-15-10:30",
    "success": true,
    "friendlyErrorMessage": null
  }
  ```

  
  ```json Response - Código Inválido
  {
    "transactionId": "PDV-001-2024-01-15-10:30",
    "success": false,
    "friendlyErrorMessage": "Código inválido. Tente novamente."
  }
  ```

  </CodeGroup>
</Accordion>

<Warning>
  Se `success=false`, o fluxo não deve continuar. O vendedor pode solicitar um novo código ou cancelar a operação.
</Warning>

---

### 3. Resgatar Recompensa

<ParamField path="/rewards/{id}/redeem">
  Realiza o resgate de uma recompensa para o cliente.
</ParamField>

<Note>
  **Importante**: Diferente de outros endpoints da BonifiQ, este endpoint **NÃO** gera um cupom automaticamente. O PDV é responsável por aplicar o desconto diretamente no pedido.
</Note>

##### Path Parameters

<ParamField path="id" type="integer" required>
  ID da recompensa a ser resgatada (obtido no endpoint `/rewards/available`).
</ParamField>

<Accordion title="Request Body">
  <ParamField body="CustomerId" type="string" required>
    Identificador do cliente (CPF/CNPJ ou e-mail).
  </ParamField>
  <ParamField body="Value" type="decimal">
    **Obrigatório apenas para Cashback**. Valor de cashback que o cliente deseja utilizar. Deve estar entre R\$1,00 e o `maxCashbackForCurrentPurchase`.
  </ParamField>
  <ParamField body="Points" type="integer">
    **Alternativa ao Value para Cashback**. Quantidade de pontos a utilizar. Use `Value` ou `Points`, não ambos.
  </ParamField>
  <ParamField body="OriginalKey" type="string" required>
    Chave única para garantir idempotência. Mesmo que a requisição seja feita mais de uma vez, o resgate acontecerá apenas uma vez.

    **Sugestão de formato**: `{rewardId}-{customerId}-{orderId}-{value}`

    Exemplo: `3-12345678900-PDV001-15.00`
  </ParamField>
  <ParamField body="Branch" type="object">
    Informações da filial/loja onde a compra está sendo realizada.

    <Expandable title="Propriedades">
      <ParamField body="Branch.OriginalId" type="string">
        ID da filial no sistema do cliente.
      </ParamField>
      <ParamField body="Branch.Name" type="string">
        Nome da filial.
      </ParamField>
    </Expandable>
  </ParamField>
  <ParamField body="SalesPerson" type="object">
    Informações do vendedor responsável pela venda.

    <Expandable title="Propriedades">
      <ParamField body="SalesPerson.OriginalId" type="string">
        ID do vendedor no sistema do cliente.
      </ParamField>
      <ParamField body="SalesPerson.Name" type="string">
        Nome do vendedor.
      </ParamField>
    </Expandable>
  </ParamField>
  <ParamField body="Metadatas" type="array">
    Lista de metadados customizados para necessidades específicas do negócio.

    <Expandable title="Propriedades">
      <ParamField body="Metadatas[].Name" type="string">
        Nome do metadado.
      </ParamField>
      <ParamField body="Metadatas[].Value" type="string">
        Valor do metadado.
      </ParamField>
    </Expandable>
  </ParamField>
  <CodeGroup>

  ```json Request - Desconto Fixo
  {
    "customerId": "12345678900",
    "value": null,
    "points": null,
    "originalKey": "1-12345678900-PDV001",
    "branch": {
      "originalId": "LOJA-001",
      "name": "Loja Centro"
    },
    "salesPerson": {
      "originalId": "VEND-123",
      "name": "João Silva"
    }
  }
  ```

  
  ```json Request - Cashback
  {
    "customerId": "12345678900",
    "value": 15.00,
    "points": null,
    "originalKey": "3-12345678900-PDV001-15.00",
    "branch": {
      "originalId": "LOJA-001",
      "name": "Loja Centro"
    }
  }
  ```

  
  ```json Response - Sucesso
  {
    "hasError": false,
    "errorMessage": null,
    "data": {
      "rewardId": 456,
      "point": {
        "pointId": 789,
        "quantity": -100,
        "metadatas": null
      },
      "externalCode": "BNF-2024-ABC123",
      "originalKey": "1-12345678900-PDV001",
      "coupon": null
    }
  }
  ```

  </CodeGroup>
</Accordion>

<Accordion title="Campos de Resposta">
  <ResponseField name="data.rewardId" type="integer">
    ID único do resgate realizado. Use este ID para cancelar a recompensa se necessário.
  </ResponseField>
  <ResponseField name="data.externalCode" type="string">
    **IMPORTANTE**: Este código deve ser enviado no campo `Coupon` quando o pedido for cadastrado na BonifiQ. Isso vincula o resgate ao pedido.
  </ResponseField>
  <ResponseField name="data.originalKey" type="string">
    Mesma chave enviada na requisição, confirmando a idempotência.
  </ResponseField>
  <ResponseField name="data.point.pointId" type="integer">
    ID do registro de pontos gerado pelo resgate.
  </ResponseField>
  <ResponseField name="data.point.quantity" type="integer">
    Quantidade de pontos utilizados (valor negativo indica débito).
  </ResponseField>
</Accordion>

<Tip>
  Após receber a resposta de sucesso, aplique o desconto correspondente no pedido do PDV. O tipo e valor do desconto foram informados no endpoint `/rewards/available`.
</Tip>

---

### 4. Cancelar Recompensa

Existem duas formas de cancelar uma recompensa resgatada:

#### 4.1. Cancelar por ID da Recompensa

<ParamField path="/rewards/{id}">
  Cancela uma recompensa pelo ID do resgate.
</ParamField>

##### Path Parameters

<ParamField path="id" type="integer" required>
  O `RewardId` retornado no endpoint de resgate.
</ParamField>

<Accordion title="Exemplo de Requisição e Resposta">
  <CodeGroup>

  ```bash Request
  DELETE /v1/pvt/POS/rewards/456
  ```

  
  ```json Response
  {
    "hasError": false,
    "data": {
      "id": 456,
      "customer": {
        "originalId": "12345678900",
        "name": "Maria Silva",
        "email": "maria@email.com"
      },
      "externalCode": "BNF-2024-ABC123",
      "cashValue": 10.00,
      "isCanceled": true,
      "redeemDate": "2024-01-15T10:30:00Z",
      "points": {
        "id": 789,
        "points": -100,
        "type": 4,
        "eventKey": "reward-456"
      }
    }
  }
  ```

  </CodeGroup>
</Accordion>

#### 4.2. Cancelar por OriginalKey

<ParamField path="/rewards">
  Cancela uma recompensa pela OriginalKey usada no resgate.
</ParamField>

<Accordion title="Request Body e Resposta">
  <ParamField body="OriginalKey" type="string" required>
    A mesma `OriginalKey` utilizada no momento do resgate.
  </ParamField>
  <CodeGroup>

  ```json Request
  {
    "originalKey": "1-12345678900-PDV001"
  }
  ```

  
  ```json Response
  {
    "hasError": false,
    "data": {
      "id": 456,
      "customer": {
        "originalId": "12345678900",
        "name": "Maria Silva",
        "email": "maria@email.com"
      },
      "externalCode": "BNF-2024-ABC123",
      "cashValue": 10.00,
      "isCanceled": true,
      "redeemDate": "2024-01-15T10:30:00Z",
      "points": {
        "id": 789,
        "points": -100,
        "type": 4,
        "eventKey": "reward-456"
      }
    }
  }
  ```

  </CodeGroup>
</Accordion>

<Warning>
  O cancelamento de uma recompensa **devolve os pontos ao cliente**. Esta operação não pode ser desfeita.
</Warning>

---

### 5. Cadastrar Pedido

<ParamField path="/orders">
  Cadastra um pedido na BonifiQ para que o cliente receba os pontos correspondentes.
</ParamField>

<Note>
  Este é um endpoint essencial. Sem o cadastro do pedido, o cliente não receberá os pontos da compra.
</Note>

<Accordion title="Request Body">
  <ParamField body="OriginalId" type="string" required>
    ID do pedido no sistema do cliente (PDV).
  </ParamField>
  <ParamField body="OrderPlacementDate" type="datetime" required>
    Data/hora em que o pedido foi realizado.
  </ParamField>
  <ParamField body="OrderCompletedDate" type="datetime">
    Data/hora em que o pedido foi concluído. Obrigatório se `IsCompleted=true`.
  </ParamField>
  <ParamField body="OrderCancelledDate" type="datetime">
    Data/hora do cancelamento. Obrigatório se `IsCancelledOrReturned=true`.
  </ParamField>
  <ParamField body="OrderStatus" type="string">
    Status do pedido no sistema de origem (informativo).
  </ParamField>
  <ParamField body="IsCompleted" type="boolean" required>
    Se `true`, o pedido está finalizado e os pontos serão concedidos ao cliente.
  </ParamField>
  <ParamField body="IsCancelledOrReturned" type="boolean" required>
    Se `true`, o pedido foi cancelado ou devolvido.
  </ParamField>
  <ParamField body="OrderTotal" type="decimal" required>
    **Valor pago pelo cliente**. Este valor determina quantos pontos o cliente receberá.

    <Warning>
      **NÃO inclua** neste valor:

      - Frete
      - Descontos
      - Cupons
      - Cashback
      - Promoções
      - Gift cards
    </Warning>
  </ParamField>
  <ParamField body="Coupon" type="string">
    **IMPORTANTE**: Se o pedido utilizou uma recompensa da BonifiQ, informe aqui o `ExternalCode` retornado no resgate. Se não utilizou recompensa BonifiQ mas usou outro cupom, informe o código do cupom.
  </ParamField>
  <ParamField body="Customer" type="object" required>
    Dados do cliente comprador.

    <Expandable title="Propriedades">
      <ParamField body="Customer.OriginalId" type="string" required>
        ID do cliente no sistema de origem.
      </ParamField>
      <ParamField body="Customer.Name" type="string" required>
        Nome do cliente.
      </ParamField>
      <ParamField body="Customer.Email" type="string">
        E-mail do cliente.
      </ParamField>
      <ParamField body="Customer.Phone" type="string">
        Telefone do cliente.
      </ParamField>
      <ParamField body="Customer.Document" type="string">
        CPF ou CNPJ do cliente (apenas números).
      </ParamField>
      <ParamField body="Customer.BirthdayDate" type="datetime">
        Data de nascimento do cliente.
      </ParamField>
      <ParamField body="Customer.SignupDate" type="datetime">
        Data de cadastro do cliente.
      </ParamField>
      <ParamField body="Customer.IsEnrolled" type="boolean">
        Se `true`, o cliente participa do programa de fidelidade. Default: `true`.
      </ParamField>
    </Expandable>
  </ParamField>
  <ParamField body="Products" type="array">
    Lista de produtos do pedido.

    <Expandable title="Propriedades">
      <ParamField body="Products[].OriginalId" type="string">
        ID do produto.
      </ParamField>
      <ParamField body="Products[].Name" type="string">
        Nome do produto.
      </ParamField>
      <ParamField body="Products[].Quantity" type="integer">
        Quantidade.
      </ParamField>
      <ParamField body="Products[].Price" type="decimal">
        Preço unitário.
      </ParamField>
    </Expandable>
  </ParamField>
  <ParamField body="PaymentMethod" type="object">
    Método de pagamento utilizado.

    <Expandable title="Propriedades">
      <ParamField body="PaymentMethod.OriginalId" type="string">
        ID do método de pagamento.
      </ParamField>
      <ParamField body="PaymentMethod.Name" type="string">
        Nome do método (ex: "Cartão Visa Crédito", "PIX", "Dinheiro").
      </ParamField>
    </Expandable>
  </ParamField>
  <ParamField body="Branch" type="object">
    Filial onde a compra foi realizada.

    <Expandable title="Propriedades">
      <ParamField body="Branch.OriginalId" type="string">
        ID da filial.
      </ParamField>
      <ParamField body="Branch.Name" type="string">
        Nome da filial.
      </ParamField>
    </Expandable>
  </ParamField>
  <ParamField body="SalesPerson" type="object">
    Vendedor responsável pela venda.

    <Expandable title="Propriedades">
      <ParamField body="SalesPerson.OriginalId" type="string">
        ID do vendedor.
      </ParamField>
      <ParamField body="SalesPerson.Name" type="string">
        Nome do vendedor.
      </ParamField>
    </Expandable>
  </ParamField>
  <ParamField body="Metadatas" type="array">
    Lista de metadados customizados.

    <Expandable title="Propriedades">
      <ParamField body="Metadatas[].Name" type="string">
        Nome do metadado.
      </ParamField>
      <ParamField body="Metadatas[].Value" type="string">
        Valor do metadado.
      </ParamField>
    </Expandable>
  </ParamField>
</Accordion>

<Accordion title="Exemplos de Requisição e Resposta">
  <CodeGroup>

  ```json Request - Pedido com Recompensa BonifiQ
  {
    "originalId": "PDV-2024-001234",
    "orderPlacementDate": "2024-01-15T10:30:00Z",
    "orderCompletedDate": "2024-01-15T10:35:00Z",
    "orderCancelledDate": null,
    "orderStatus": "Concluído",
    "isCancelledOrReturned": false,
    "isCompleted": true,
    "orderTotal": 140.00,
    "coupon": "BNF-2024-ABC123",
    "customer": {
      "originalId": "CLI-12345",
      "name": "Maria Silva",
      "email": "maria@email.com",
      "phone": "11999998888",
      "document": "12345678900",
      "birthdayDate": "1990-05-15",
      "signupDate": "2023-06-01T00:00:00Z",
      "isEnrolled": true
    },
    "products": [
      {
        "originalId": "PROD-001",
        "name": "Camiseta Azul M",
        "quantity": 2,
        "price": 75.00
      }
    ],
    "paymentMethod": {
      "originalId": "PIX",
      "name": "PIX"
    },
    "branch": {
      "originalId": "LOJA-001",
      "name": "Loja Centro"
    },
    "salesPerson": {
      "originalId": "VEND-123",
      "name": "João Silva"
    },
    "metadatas": [
      {
        "name": "canal_venda",
        "value": "presencial"
      }
    ]
  }
  ```

  
  ```json Request - Pedido sem Recompensa
  {
    "originalId": "PDV-2024-001235",
    "orderPlacementDate": "2024-01-15T11:00:00Z",
    "orderCompletedDate": "2024-01-15T11:05:00Z",
    "orderCancelledDate": null,
    "orderStatus": "Concluído",
    "isCancelledOrReturned": false,
    "isCompleted": true,
    "orderTotal": 200.00,
    "coupon": null,
    "customer": {
      "originalId": "CLI-67890",
      "name": "João Santos",
      "email": "joao@email.com",
      "phone": "11888887777",
      "document": "98765432100",
      "isEnrolled": true
    }
  }
  ```

  
  ```json Response - Sucesso
  {
    "hasError": false,
    "errorMessage": null,
    "data": {
      "originalId": "PDV-2024-001234",
      "orderPlacementDate": "2024-01-15T10:30:00Z",
      "orderCompletedDate": "2024-01-15T10:35:00Z",
      "orderCancelledDate": null,
      "orderStatus": "Concluído",
      "isCancelledOrReturned": false,
      "isCompleted": true,
      "orderTotal": 140.00,
      "coupon": "BNF-2024-ABC123",
      "state": 2,
      "origin": 1,
      "customer": {
        "originalId": "CLI-12345",
        "name": "Maria Silva",
        "email": "maria@email.com"
      }
    }
  }
  ```

  </CodeGroup>
</Accordion>

#### Estados do Pedido (state)

| Valor | Estado    | Descrição                            |
| ----- | --------- | ------------------------------------ |
| 0     | Inicial   | Pedido recém criado                  |
| 1     | Pendente  | Aguardando conclusão                 |
| 2     | Completo  | Pedido finalizado, pontos concedidos |
| 3     | Cancelado | Pedido cancelado, pontos estornados  |
| 4     | Ignorado  | Pedido ignorado pelo sistema         |

---

### 6. Cancelar Pedido

<ParamField path="/orders/{orderId}/cancel">
  Cancela um pedido existente na BonifiQ.
</ParamField>

Quando um pedido é cancelado, a BonifiQ automaticamente:

- Marca o pedido como Cancelado (refletido nos relatórios)
- Estorna os pontos concedidos ao cliente (se houver)
- Estorna as recompensas utilizadas (se houver)

##### Path Parameters

<ParamField path="orderId" type="string" required>
  O `OriginalId` do pedido que foi enviado quando o pedido foi criado.
</ParamField>

<Accordion title="Request Body e Resposta">
  <ParamField body="OrderCancelledDate" type="datetime" required>
    Data/hora do cancelamento.
  </ParamField>
  <ParamField body="OrderStatus" type="string">
    Novo status do pedido (informativo).
  </ParamField>
  <CodeGroup>

  ```json Request
  {
    "orderCancelledDate": "2024-01-15T15:30:00Z",
    "orderStatus": "Cancelado"
  }
  ```

  
  ```json Response
  {
    "hasError": false,
    "data": {
      "isCanceled": true,
      "updatedAt": "2024-01-15T15:30:00Z",
      "status": {
        "code": 3,
        "description": "Cancelado"
      }
    }
  }
  ```

  </CodeGroup>
</Accordion>

---

### 7. Cancelamento Parcial de Pedido

<ParamField path="/{orderId}/partialcancel">
  Cancela parcialmente um pedido, estornando pontos/cashback proporcionalmente.
</ParamField>

Use este endpoint quando o cliente devolve apenas parte dos produtos de uma compra.

##### Path Parameters

<ParamField path="orderId" type="string" required>
  O `OriginalId` do pedido.
</ParamField>

<Accordion title="Request Body e Resposta">
  <ParamField body="ValueToRefund" type="decimal" required>
    Valor a ser estornado. Deve ser maior que zero e menor ou igual ao `OrderTotal` original.
  </ParamField>
  <ParamField body="CancelKey" type="string" required>
    Chave única para garantir idempotência. Evita cancelamentos duplicados do mesmo valor. Use um ID único para cada solicitação de cancelamento parcial.
  </ParamField>
  <CodeGroup>

  ```json Request
  {
    "valueToRefund": 50.00,
    "cancelKey": "REFUND-PDV001-2024-001"
  }
  ```

  
  ```json Response
  {
    "hasError": false,
    "data": {
      "isCanceled": true,
      "updatedAt": "2024-01-15T16:00:00Z",
      "status": {
        "code": 2,
        "description": "Completo"
      }
    }
  }
  ```

  </CodeGroup>
</Accordion>

<Note>
  O cancelamento parcial estorna pontos/cashback proporcionalmente ao valor devolvido. Por exemplo, se o pedido original era de R$200,00 e rendeu 200 pontos, um estorno de R$50,00 removerá aproximadamente 50 pontos do cliente.
</Note>

---

## Guia de Implementação no PDV

### Fluxo Resumido

```mermaid
flowchart TD
    A[Cliente informa CPF/CNPJ] --> B[Consultar Recompensas]
    B --> C{Há recompensas?}
    C -->|Não| D[Continuar sem recompensa]
    C -->|Sim| E[Exibir recompensas ao vendedor]
    E --> F{Cliente escolhe recompensa?}
    F -->|Não| D
    F -->|Sim| G{Validação necessária?}
    G -->|Sim| H[Enviar Challenge]
    H --> I[Cliente informa código]
    I --> J[Validar Challenge]
    J -->|Sucesso| K[Resgatar Recompensa]
    J -->|Falha| H
    G -->|Não| K
    K --> L[Aplicar desconto no PDV]
    L --> M[Finalizar venda]
    M --> N[Cadastrar Pedido na BonifiQ]
    D --> M
```

### Mockups de Interface

#### Tela de Consulta de Recompensas

Ao consultar as recompensas (`/rewards/available`), exiba as informações da seguinte forma:

<Frame>
  ![Lista de Recompensas](/images/pos-rewards-list.png)
</Frame>

| Campo da API   | Uso na Interface                            |
| -------------- | ------------------------------------------- |
| `title`        | Título principal da recompensa              |
| `points`       | "X pontos" abaixo do título                 |
| `requirements` | Texto secundário com requisitos             |
| `canUse`       | Se `false`, mostrar item desabilitado/cinza |

#### Seletor de Valor de Cashback

Quando a recompensa for cashback (`isCashback=true`), exiba um seletor de valor:

<Frame>
  ![Seletor de Cashback](/images/pos-cashback-selector.png)
</Frame>

| Campo da API                    | Uso na Interface             |
| ------------------------------- | ---------------------------- |
| `availableCashback`             | "Saldo disponível: R\$ X"    |
| `maxCashbackForCurrentPurchase` | Valor máximo do slider/input |
| `requirements`                  | Explicação do limite         |

---

## Tratamento de Erros

Todos os endpoints retornam erros no seguinte formato:

```json
{
  "hasError": true,
  "errorMessage": "Descrição técnica do erro",
  "friendlyErrorMessage": "Mensagem amigável para o usuário"
}
```

### Códigos de Erro Comuns

| Cenário                                | Ação Recomendada                                       |
| -------------------------------------- | ------------------------------------------------------ |
| Cliente não encontrado                 | Verificar se o documento foi digitado corretamente     |
| Pontos insuficientes                   | Informar ao cliente que ele não tem pontos suficientes |
| Valor de compra abaixo do mínimo       | Informar o valor mínimo necessário                     |
| Challenge expirado                     | Solicitar novo código ao cliente                       |
| Código PIN inválido                    | Permitir nova tentativa ou cancelar                    |
| Recompensa já resgatada (idempotência) | A operação já foi realizada, prosseguir                |

---

## Boas Práticas

<AccordionGroup>
  <Accordion title="Sempre use OriginalKey para idempotência">
    Em sistemas distribuídos, falhas de rede podem causar requisições duplicadas. Use sempre a `OriginalKey` com um valor único e consistente para evitar resgates ou cancelamentos duplicados.
  </Accordion>
  <Accordion title="Vincule o resgate ao pedido">
    Sempre envie o `ExternalCode` retornado no resgate como valor do campo `Coupon` ao cadastrar o pedido. Isso permite rastreamento completo.
  </Accordion>
  <Accordion title="Não inclua descontos no OrderTotal">
    O `OrderTotal` deve refletir apenas o valor efetivamente pago pelo cliente, sem frete, descontos, cupons ou promoções. Isso garante o cálculo correto de pontos.
  </Accordion>
  <Accordion title="Trate a validação como opcional">
    Verifique o campo `shouldValidateCustomer` antes de iniciar o fluxo de challenge. Se `false`, pule direto para o resgate.
  </Accordion>
  <Accordion title="Exiba recompensas indisponíveis como desabilitadas">
    Mesmo que `canUse=false`, exiba a recompensa ao cliente (em estado desabilitado). Isso o motiva a acumular mais pontos para futuras compras.
  </Accordion>
</AccordionGroup>

---

## Suporte

Em caso de dúvidas ou problemas na integração:

- **Documentação Swagger**: [API Docs](https://api.bonifiq.com.br/apidocs/private/index.html?url=/swagger/Private%20APIs/swagger.json#/POS)
- **Central de Ajuda**: [suporte.bonifiq.com.br](https://suporte.bonifiq.com.br)
- **E-mail**: [suporte@bonifiq.com.br](mailto:suporte@bonifiq.com.br)