---
title: "API de Checkout"
description: "A BonifiQ já oferece uma solução nativa para integrar diretamente ao Checkout da VTEX no modelo Web. No modelo Mobile, no entanto, requer que seja realizada a integração com as APIs da BonifiQ diremente
"
---

As integrações abrangem login seguro, consulta e aplicação de recompensa. As chamadas são projetadas para garantir uma experiência segura e eficiente para o consumidor.

### Principais Etapas

1. **Login seguro:** Autenticação do usuário e obtenção de token de segurança.
2. **Consulta de recompensas:** Verificação do saldo e regras para utilização da recompensa.
3. **Aplicação de recompensa:** Resgate de recompensa no carrinho.
4. **Consulta de recompensa aplicado:** Verificação do estado da recompensa no carrinho.
5. **Remoção de recompensa:** Remover a recompensa aplicada a um carrinho.

---

## 1. Fazer Login Seguro

O primeiro passo é realizar o login do usuário e obter o seu token de segurança. Esse token de segurança será utilizado em todas as chamadas subsequentes.

O `sessionToken`e o `segmentToken`deverão ser obtidos mediante login na VTEX.  

<Note>
  O `SecureToken` tem validade limitada e deve ser atualizado periodicamente.
</Note>

### Requisição

`POST /pub/widget/vendors/vtex/securelogin`

**Headers**

<ParamField header="X-Bq-Tenant" type="string" required>
  Identificador público da loja.
</ParamField>

**Body**

<ParamField body="sessionToken" type="string" required>
  Gerado pela plataforma de e-commerce após o login do consumidor.
</ParamField>

<ParamField body="segmentToken" type="string" required>
  Gerado pela plataforma de e-commerce.
</ParamField>

### Exemplo

```bash
curl -X POST "https://api.bonifiq.com/pub/widget/vendors/vtex/securelogin" \
  -H "X-Bq-Tenant: {tenant_key}" \
  -d '{
    "sessionToken": "<session_token>",
    "segmentToken": "<segment_token>"
  }'
```

### Resposta

<ResponseField name="HasError" type="boolean">
  Indica se houve erro na requisição.
</ResponseField>

<ResponseField name="Item" type="object">
  <Expandable title="Properties">
    <ResponseField name="Email" type="string">
      E-mail do usuário.
    </ResponseField>
    <ResponseField name="SecureToken" type="string">
      Token de segurança do usuário, com validade de 60 minutos.
    </ResponseField>
  </Expandable>
</ResponseField>

```json
{
  "HasError": false,
  "Message": null,
  "Item": {
    "Email": "usuario@dominio.com",
    "Name": "Nome Completo",
    "UserId": "usuario@dominio.com",
    "SecureToken": "742b9b93-c1dc-4ec1-8f92-6b3a1838c613"
  }
}
```

---

## 2. Buscar Recompensas

Essa etapa será utilizada para a listagem de recompensas disponíveis para o usuário logado.

### Requisição

`GET /pub/widget/rewards/checkout`

**Headers**

<ParamField header="X-Bq-Tenant" type="string" required>
  Identificador da loja.
</ParamField>

<ParamField header="X-Bq-SecureToken" type="string" required>
  Token do usuário obtido no login seguro.
</ParamField>

**Query Parameters**

<ParamField query="purchaseValue" type="number" required>
  Valor da compra.
</ParamField>

### Exemplo

```bash
curl -X GET "https://api.bonifiq.com/pub/widget/rewards/checkout?purchaseValue=100.00" \
  -H "X-Bq-Tenant: {tenant_key}" \
  -H "X-Bq-SecureToken: {secure_token}"
```

### Resposta

<ResponseField name="Item" type="array">
  Lista de recompensas.

  <Expandable title="Item Object">
    <ResponseField name="UseReason" type="number">
      Motivo da disponibilidade/indisponibilidade.
    </ResponseField>
    <ResponseField name="RemainingToUse" type="number">
      Valor restante para atingir o mínimo (se `UseReason` for 2).
    </ResponseField>
  </Expandable>
</ResponseField>

```json
{
  "ProgramName": "VTEX IO QA",
  "PointsBalance": 10000,
  "HasError": false,
  "Message": null,
  "Item": [
    {
      "Id": 301,
      "Type": 1,
      "Title": "R$ 100,00",
      "Points": 100,
      "Description": "Descrição da recompensa...",
      "Enabled": true,
      "CanUse": true,
      "UseReason": 0,
      "RemainingToUse": 445,
      "MinValueToUse": 0
    }
  ]
}
```

#### Enumeração `RewardCheckoutUseReason`

| Valor | Descrição                               |
| :---- | :-------------------------------------- |
| 0     | CanUse (Recompensa disponível para uso) |
| 1     | NotEnoughPoints                         |
| 2     | MinValueNotReached                      |
| 3     | CashbackNotAvailable                    |
| 4     | NoCustomer                              |
| 5     | ValueRewardBiggerThanPurchase           |
| 6     | MinimumPercentPurchaseNotReached        |
| 7     | CustomerNotEnrolled                     |

---

## 2.1. Buscar Recompensas já Resgatadas

Essa etapa será utilizada para a listagem de recompensas já resgatadas e não utilizadas pelo consumidor.

### Requisição

`GET /pub/widget/rewards/checkout/redeemed`

**Headers**

<ParamField header="X-Bq-Tenant" type="string" required>
  Identificador da loja.
</ParamField>

<ParamField header="X-Bq-SecureToken" type="string" required>
  Token do usuário obtido no login seguro.
</ParamField>

**Query Parameters**

<ParamField query="purchaseValue" type="number" required>
  Valor da compra.
</ParamField>

### Exemplo de Resposta

```json
{
  "HasError": false,
  "Message": null,
  "Item": [
    {
      "RedeemedId": 1302,
      "RedeemedPoints": -10,
      "RedeemedValue": 0,
      "Id": 302,
      "Type": 0,
      "Title": "10%",
      "Points": 10,
      "CanUse": true,
      "UseReason": 0
    }
  ]
}
```

---

## 3. Aplicar Recompensa

Essa etapa será utilizada para a aplicação de recompensas ainda não resgatadas.

### Requisição

`POST /pub/widget/rewards/redeem/{reward_id}`

**Headers**

<ParamField header="X-Bq-Tenant" type="string" required>
  Identificador da loja.
</ParamField>

<ParamField header="X-Bq-SecureToken" type="string" required>
  Token do usuário obtido no login seguro.
</ParamField>

**Path Parameters**

<ParamField path="reward_id" type="integer" required>
  ID da recompensa a ser resgatada.
</ParamField>

**Body (Opcional)**

<ParamField body="OriginalId" type="string">
  Identificador do carrinho (order_form_id).
</ParamField>

```json
{
  "OriginalId": "<order_form_id>"
}
```

### Exemplo de Resposta

```json
{
  "HasError": false,
  "Message": "Tudo Certo! Em breve você irá receber um e-mail com mais instruções",
  "Item": {
    "Success": true,
    "ResultMessage": "Utilize seu cupom nesta compra:",
    "CouponCode": "c806711b278a463d8e787f5f5c409f89",
    "HasCouponCode": true,
    "Reward": {
      "RedeemedId": 1416,
      "Title": "2%",
      "Points": 2
    }
  }
}
```

---

## 3.1. Aplicar Recompensa já Resgatada

Essa etapa será utilizada para a aplicação de recompensas já resgatadas.

### Requisição

`POST /pub/widget/rewardredeemed/checkout/redeem/{reward_redeemed_id}`

<Warning>
  O valor de `reward_redeemed_id` deverá ser o valor retornado na propriedade `RedeemedId` da seção "Buscar Recompensas já Resgatadas".
</Warning>

**Headers**

<ParamField header="X-Bq-Tenant" type="string" required>
  Identificador da loja.
</ParamField>

<ParamField header="X-Bq-SecureToken" type="string" required>
  Token do usuário obtido no login seguro.
</ParamField>

**Path Parameters**

<ParamField path="reward_redeemed_id" type="integer" required>
  ID da recompensa resgatada.
</ParamField>

**Body (Opcional)**

<ParamField body="OriginalId" type="string">
  Identificador do carrinho (order_form_id).
</ParamField>

---

## 3.2. Aplicar Cashback

Essa etapa será utilizada para a aplicação de _cashback_.

### Requisição

`POST /pub/widget/rewards/checkout/cashback/redeem`

**Headers**

<ParamField header="X-Bq-Tenant" type="string" required>
  Identificador da loja.
</ParamField>

<ParamField header="X-Bq-SecureToken" type="string" required>
  Token do usuário obtido no login seguro.
</ParamField>

**Body**

<ParamField body="CheckoutId" type="string" required>
  Identificador do carrinho (order_form_id).
</ParamField>

<ParamField body="CashbackValue" type="number" required>
  Valor do cashback a ser resgatado.
</ParamField>

<ParamField body="RedeemOrigin" type="integer" required>
  Sempre 3 para relatórios internos.
</ParamField>

<ParamField body="Total" type="number" required>
  Valor do carrinho (sem descontos ou frete).
</ParamField>

### Exemplo de Resposta

```json
{
  "AppliedCashback": 0,
  "Success": true,
  "CustomerMessage": "Cashback resgatado com sucesso.",
  "CashbackRules": "Pague até 50% da compra com cashback.",
  "InternalMessage": null,
  "CouponCode": null
}
```

---

## 4. Consultar Recompensa Aplicada

Esta etapa será utilizada para o caso do cliente saia da tela do checkout e seja necessário reaplicar o estado de recompensa resgatada a ele.

### Requisição

`POST /pub/widget/rewards/checkout`

**Headers**

<ParamField header="X-Bq-Tenant" type="string" required>
  Identificador da loja.
</ParamField>

<ParamField header="X-Bq-SecureToken" type="string" required>
  Token do usuário obtido no login seguro.
</ParamField>

**Body**

<ParamField body="CheckoutCode" type="string" required>
  Identificador do carrinho (order_form_id).
</ParamField>

```json
{
  "CheckoutCode": "<order_form_id>"
}
```

### Exemplo de Resposta

```json
{
  "ProgramName": "VTEX IO QA",
  "HasError": false,
  "Item": {
    "Success": true,
    "CouponCode": "c806711b278a463d8e787f5f5c409f89",
    "Reward": {
      "Id": 302,
      "Title": "10%",
      "Points": 10,
      "CanUse": false
    }
  }
}
```

---

## 5. Remover Recompensa Aplicada

Esta etapa será utilizada para remoção de uma recompensa que foi aplicada ao carrinho.

<Warning>
  Este método apenas remove a recompensa resgatada do carrinho. Ele não realiza o estorno dos pontos para a carteira do consumidor e nem cancela o resgate da recompensa.
</Warning>

### Requisição

`POST /pub/widget/rewards/checkout/{reward_redeemed_id}/reverse`

**Headers**

<ParamField header="X-Bq-Tenant" type="string" required>
  Identificador da loja.
</ParamField>

<ParamField header="X-Bq-SecureToken" type="string" required>
  Token do usuário obtido no login seguro.
</ParamField>

**Path Parameters**

<ParamField path="reward_redeemed_id" type="integer" required>
  ID da recompensa resgatada a ser removida do carrinho.
</ParamField>

---

## 5.1. Remover Cashback Aplicado

Esta etapa será utilizada para remoção de um _cashback_ que foi aplicada ao carrinho.

<Warning>
  Este método remove o _cashback_ do carrinho e também realiza o estorno dos pontos de volta a carteira do consumidor, diferentemente da remoção de recompensa.
</Warning>

### Requisição

`POST /pub/widget/rewards/checkout/cashback/redeem/remove`

**Headers**

<ParamField header="X-Bq-Tenant" type="string" required>
  Identificador da loja.
</ParamField>

<ParamField header="X-Bq-SecureToken" type="string" required>
  Token do usuário obtido no login seguro.
</ParamField>

**Body**

<ParamField body="CheckoutId" type="string" required>
  Identificador do carrinho (order_form_id).
</ParamField>

<ParamField body="Total" type="number" required>
  Valor do carrinho (sem descontos ou frete).
</ParamField>

```json
{
  "CheckoutId": "<order_form_id>",
  "Total": 0
}
```

### Exemplo de Resposta

```json
{
	"Success": true,
	"CustomerMessage": "O cashback foi removido com sucesso"
}
```